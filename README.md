# Drive-Metro: Схема автомаршрутов России

Эталонная схема автомаршрутов по городам России в стиле московского метро.

## Особенности

- **Метро-стиль дизайн**: Минималистичный, чистый интерфейс как у Мосметро
- **Умное объединение маршрутов**: Автоматическое выделение основных веток и ответвлений
- **Основные ветки**: Общие участки (3+ линий) рисуются толще и ярче
- **Ответвления**: Уникальные участки (1-2 линии) отображаются как тонкие линии
- **Интерактивность**: Пан/зум, подсветка маршрутов, клик по станциям
- **LOD (Level of Detail)**: Адаптивное отображение подписей в зависимости от зума
- **Коллизионный алгоритм**: Умное размещение подписей без пересечений
- **Анимации**: Плавные переходы и hover-эффекты
- **Адаптивность**: Работает на десктопе и мобильных устройствах

## Структура данных

Данные хранятся в CSV файлах в папке `public/data/`:

- `cities.csv` - города с координатами и флагом узла (is_hub)
- `lines.csv` - линии с цветами и стилями
- `line_paths.csv` - маршруты линий через города
- `corridors.csv` - группировка линий по коридорам

## Управление

### Навигация
- **Колесо мыши** - зум к курсору
- **Перетаскивание** - пан по карте
- **Кнопки +/-** - зум с фиксированным шагом
- **"Подогнать к данным"** - автозум для показа всех станций

### Интерактивность
- **Клик по линии** - подсветка маршрута
- **Hover по линии** - временная подсветка
- **Клик по станции** - закрепление подсветки
- **ESC** - сброс всех подсветок

### Легенда
- **Коридоры** - группировка линий по направлениям
- **Кнопки "Все/Нет"** - массовое включение/выключение
- **Чекбоксы** - индивидуальное управление линиями

## Технические детали

### Архитектура
- **React + Next.js** - основа приложения
- **SVG** - рендеринг схемы
- **TypeScript** - типизация
- **CSS-in-JS** - стилизация

### Алгоритмы
- **Анализ маршрутов** - автоматическое выделение основных веток и ответвлений
- **Объединение сегментов** - группировка общих участков для устранения наслойки
- **Размещение подписей** - квадрантный алгоритм с коллизионным детектором
- **LOD** - адаптивное отображение в зависимости от зума

### Конфигурация
Все параметры вынесены в `src/lib/metro-config.ts`:
- Толщины линий и радиусы станций
- Цвета и типографика
- Пороги LOD и анимации
- Настройки зума и паддингов

## Разработка

```bash
# Установка зависимостей
npm install

# Запуск в режиме разработки
npm run dev

# Сборка для продакшена
npm run build
```

## Структура проекта

```
src/
├── app/                 # Next.js App Router
├── components/          # React компоненты
│   ├── MetroCanvas.tsx  # Основной компонент схемы
│   └── Legend.tsx       # Легенда с фильтрами
└── lib/                 # Утилиты и логика
    ├── types.ts         # TypeScript типы
    ├── csv.ts           # Парсинг CSV
    ├── graph.ts         # Работа с графом
    ├── geometry.ts      # Геометрические вычисления
    ├── label-placer.ts  # Алгоритм размещения подписей
    ├── route-analyzer.ts # Анализ и объединение маршрутов
    └── metro-config.ts  # Конфигурация
```

## Добавление новых данных

Для добавления новой линии или города достаточно отредактировать соответствующие CSV файлы - интерфейс автоматически обновится без изменения кода.
